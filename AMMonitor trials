library(AMMonitor)
library(AMModels)
library(monitoR)
library(caret)
library(RSQLite)
library(data.table)
library(DBI)
library(lubridate)

setwd("C:/Dropbox/AMMonitor")
ammCreateDirectories(amm.dir.name = "AMMonitor", 
                     file.path = "C:/Dropbox")


activity <- AMModels::amModelLib(description = "This library stores models that predict species activity patterns.")
classifiers <- AMModels::amModelLib(description = "This library stores classification models (machine learning models) that can be used to predict the probability that a detected signal is from a target species.")
soundscape <- AMModels::amModelLib(description = "This library stores results of a soundscape analysis.")
do_fp <- AMModels::amModelLib(description = "This library stores results of dynamic occupancy analyses that can handle false positive detections.")
info <- list(PI = 'Bilbo Baggins', 
             Organization = 'Middle Earth Conservancy')

# Add metadata to each library
ammlInfo(activity) <- info
ammlInfo(classifiers) <- info
ammlInfo(soundscape) <- info
ammlInfo(do_fp) <- info
saveRDS(object = activity, file = "ammls/activity.RDS")
saveRDS(object = classifiers, file = "ammls/classifiers.RDS")
saveRDS(object = soundscape, file = "ammls/soundscape.RDS")
saveRDS(object = do_fp, file = "ammls/do_fp.RDS")

# Create a sample database for this chapter
dbCreateSample(db.name = "Chap2.sqlite", 
               file.path = paste0(getwd(),"/database"), 
               tables =  'all')

# Establish the database file path as db.path
db.path <- paste0(getwd(), '/database/Chap2.sqlite')
# Connect to the database
conx <- RSQLite::dbConnect(drv = dbDriver('SQLite'), dbname = db.path)
# Turn the SQLite foreign constraints on
RSQLite::dbExecute(conn = conx, statement = 
                     "PRAGMA foreign_keys = ON;")


save(list = system.file("extdata", "AMMonitor_sqlite.accdb",
                        package = "AMMonitor", mustWork = TRUE), file = "database/Chap2_demo.accdb")



system.file("extdata", "AMMonitor_sqlite.accdb", package = "AMMonitor")












